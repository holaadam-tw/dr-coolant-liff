<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Coolant åˆ‡å‰Šæ¶²å¥åº·æª¢æ¸¬</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .form-container {
            padding: 30px 20px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .required-badge {
            background: #ff4757;
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .optional-badge {
            background: #a4b0be;
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .input-hint {
            font-size: 12px;
            color: #657786;
            margin-top: 5px;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            background: #a4b0be;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #657786;
        }

        .error {
            background: #ff4757;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ©º Dr. Coolant</h1>
            <p>åˆ‡å‰Šæ¶²å¥åº·æª¢æ¸¬è¡¨å–®</p>
        </div>

        <div class="form-container">
            <div id="loading" class="loading" style="display: none;">
                æ­£åœ¨åˆå§‹åŒ– LIFF...
            </div>

            <div id="error" class="error" style="display: none;"></div>

            <form id="coolantForm" style="display: none;">
                <!-- å¿…å¡«æ¬„ä½å€ -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ“‹ åŸºæœ¬è³‡æ–™
                        <span class="required-badge">å¿…å¡«</span>
                    </div>

                    <div class="form-group">
                        <label for="oil_type">åˆ‡å‰Šæ¶²ç¨®é¡ *</label>
                        <select id="oil_type" name="oil_type" required>
                            <option value="">è«‹é¸æ“‡</option>
                            <option value="é¸é … 1ï¼šå…¨åˆæˆ">é¸é … 1ï¼šå…¨åˆæˆ</option>
                            <option value="é¸é … 2ï¼šåŠåˆæˆ">é¸é … 2ï¼šåŠåˆæˆ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="ph_value">pH å€¼ *</label>
                        <input type="number" id="ph_value" name="ph_value" 
                               step="0.1" min="0" max="14" 
                               placeholder="ä¾‹ï¼š9.0" required>
                        <div class="input-hint">æ¨™æº–ç¯„åœï¼š8.5 ~ 9.5</div>
                    </div>

                    <div class="form-group">
                        <label for="brix_reading">Brix è®€æ•¸ (%) *</label>
                        <input type="number" id="brix_reading" name="brix_reading" 
                               step="0.1" min="0" max="100" 
                               placeholder="ä¾‹ï¼š3.5" required>
                        <div class="input-hint">æŠ˜å…‰å„€æ¸¬é‡å€¼</div>
                    </div>

                    <div class="form-group">
                        <label for="tank_size">æ§½é«”å®¹é‡ (å…¬å‡) *</label>
                        <input type="number" id="tank_size" name="tank_size" 
                               step="1" min="1" 
                               placeholder="ä¾‹ï¼š500" required>
                    </div>
                </div>

                <!-- ç´°èŒæª¢æ¸¬å€ï¼ˆé¸å¡«ï¼‰-->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ¦  ç´°èŒæª¢æ¸¬
                        <span class="optional-badge">é¸å¡«</span>
                    </div>

                    <div class="form-group">
                        <label for="bubble_result">é›™æ°§æ°´æ°£æ³¡æ¸¬è©¦</label>
                        <select id="bubble_result" name="bubble_result">
                            <option value="è«‹é¸æ“‡(æ­¤é¸é …ä»£è¡¨ä¸æ¸¬è©¦)">è«‹é¸æ“‡(æ­¤é¸é …ä»£è¡¨ä¸æ¸¬è©¦)</option>
                            <option value="Level 1(ç„¡åæ‡‰)">Level 1(ç„¡åæ‡‰)</option>
                            <option value="Level 2(å¾®é‡æ°£æ³¡)">Level 2(å¾®é‡æ°£æ³¡)</option>
                            <option value="Level 3(ä¸­é‡æ°£æ³¡)">Level 3(ä¸­é‡æ°£æ³¡)</option>
                            <option value="Level 4(å¤§é‡æ°£æ³¡)">Level 4(å¤§é‡æ°£æ³¡)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="resazurin_color">Dr. Coolant ç´°èŒé¡¯å½±æ¸¬è©¦</label>
                        <select id="resazurin_color" name="resazurin_color">
                            <option value="è«‹é¸æ“‡(æ­¤é¸é …ä»£è¡¨ä¸æ¸¬è©¦)">è«‹é¸æ“‡(æ­¤é¸é …ä»£è¡¨ä¸æ¸¬è©¦)</option>
                            <option value="è—è‰²">è—è‰²ï¼ˆæ­£å¸¸ï¼‰</option>
                            <option value="ç´«è‰²">ç´«è‰²ï¼ˆè¼•åº¦ï¼‰</option>
                            <option value="ç²‰ç´…è‰²">ç²‰ç´…è‰²ï¼ˆä¸­åº¦ï¼‰</option>
                            <option value="ç´…è‰²">ç´…è‰²ï¼ˆåš´é‡ï¼‰</option>
                        </select>
                    </div>
                </div>

                <!-- å…¶ä»–æª¢æ¸¬å€ï¼ˆé¸å¡«ï¼‰-->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ“Š å…¶ä»–æª¢æ¸¬æ•¸æ“š
                        <span class="optional-badge">é¸å¡«</span>
                    </div>

                    <div class="form-group">
                        <label for="conductivity">é›»å°åº¦ (Î¼S/cm)</label>
                        <input type="number" id="conductivity" name="conductivity" 
                               step="1" min="0" 
                               placeholder="ä¾‹ï¼š1500ï¼ˆæœªæ¸¬è©¦è«‹ç•™ç©ºï¼‰">
                        <div class="input-hint">æ¨™æº–ç¯„åœï¼š< 2000</div>
                    </div>

                    <div class="form-group">
                        <label for="target_conc">ç›®æ¨™æ¿ƒåº¦ (%)</label>
                        <input type="number" id="target_conc" name="target_conc" 
                               step="0.1" min="0" max="100" 
                               placeholder="ä¾‹ï¼š5.0ï¼ˆæœªæŒ‡å®šè«‹ç•™ç©ºï¼‰">
                        <div class="input-hint">è‹¥ä¸å¡«å¯«ï¼Œç³»çµ±å°‡ä½¿ç”¨æ¨™æº–å€¼</div>
                    </div>

                    <div class="form-group">
                        <label for="symptoms">è§€å¯Ÿåˆ°çš„ç—‡ç‹€</label>
                        <textarea id="symptoms" name="symptoms" 
                                  placeholder="ä¾‹ï¼šæ¶²é«”æœ‰ç•°å‘³ã€è¡¨é¢æœ‰æµ®æ²¹ã€é¡è‰²è®Šæ·±...ï¼ˆé¸å¡«ï¼‰"></textarea>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    ğŸš€ æäº¤è¨ºæ–·
                </button>
            </form>
        </div>
    </div>

    <script>
        // ===== ğŸ”— è¨­å®šå€ï¼šè«‹æ›¿æ›ç‚ºæ‚¨çš„å¯¦éš› URL =====
        const WEBHOOK_URL = 'https://eoxxxxxxxxxx.m.pipedream.net';  // â† æ›¿æ›ç‚ºæ‚¨çš„ Pipedream Webhook URL

        // ===== LIFF åˆå§‹åŒ– =====
        window.onload = function() {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const form = document.getElementById('coolantForm');

            loadingDiv.style.display = 'block';

            liff.init({
                liffId: 'è«‹æ›¿æ›ç‚ºæ‚¨çš„LIFF_ID'  // â† æ›¿æ›ç‚ºæ‚¨çš„ LIFF ID
            }).then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    loadingDiv.style.display = 'none';
                    form.style.display = 'block';
                }
            }).catch((err) => {
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'LIFF åˆå§‹åŒ–å¤±æ•—ï¼š' + err;
            });
        };

        // ===== è¡¨å–®æäº¤è™•ç† =====
        document.getElementById('coolantForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'â³ è¨ºæ–·ä¸­...';

            try {
                // å–å¾— LINE ä½¿ç”¨è€… ID
                const profile = await liff.getProfile();

                // æ•´ç†è¡¨å–®è³‡æ–™
                const formData = {
                    userId: profile.userId,
                    displayName: profile.displayName,
                    
                    // å¿…å¡«æ¬„ä½
                    oil_type: document.getElementById('oil_type').value,
                    ph_value: parseFloat(document.getElementById('ph_value').value),
                    brix_reading: parseFloat(document.getElementById('brix_reading').value),
                    tank_size: parseFloat(document.getElementById('tank_size').value),
                    
                    // é¸å¡«æ¬„ä½
                    bubble_result: document.getElementById('bubble_result').value,
                    resazurin_color: document.getElementById('resazurin_color').value,
                    conductivity: parseFloat(document.getElementById('conductivity').value) || 0,
                    target_conc: parseFloat(document.getElementById('target_conc').value) || 0,
                    symptoms: document.getElementById('symptoms').value || ''
                };

                // é©—è­‰å¿…å¡«æ¬„ä½
                if (!formData.oil_type || !formData.ph_value || !formData.brix_reading || !formData.tank_size) {
                    throw new Error('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½');
                }

                // ç™¼é€åˆ° Pipedream
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    alert('âœ… è¨ºæ–·å ±å‘Šå·²é€å‡ºï¼\n\nè«‹ç¨å¾Œæ–¼ LINE æŸ¥çœ‹è¨ºæ–·çµæœï¼ˆç´„ 10-30 ç§’ï¼‰');
                    liff.closeWindow();
                } else {
                    throw new Error('ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤ï¼š' + response.status);
                }

            } catch (error) {
                alert('âŒ é€å‡ºå¤±æ•—ï¼š' + error.message + '\n\nè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå¾Œé‡è©¦');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ğŸš€ æäº¤è¨ºæ–·';
            }
        });
    </script>
</body>
</html>
